name: Build, Push, and Deploy to Azure Container Apps

on:
  push:
    branches:
      - master

env:
  ACR_NAME: QuartoLiteTest            # <-- your ACR name (no .azurecr.io)
  IMAGE_NAME: helloworld-node:latest  # <-- image tag
  RESOURCE_GROUP: QuartoLite     # <-- your RG
  CONTAINERAPPS_ENV: helloworld-app-env   # <-- your Container Apps environment name
  CONTAINERAPP_NAME: helloworld-app   # <-- your Container App name
  LOCATION: malaysiawest              # <-- location of your resources
  AZURE_SUBSCRIPTION_ID: 90d12bc2-e05e-43bd-9943-ca14673612c4      
  AZURE_CLIENT_ID: 74825ffe-e237-4206-8781-8ed9abd1fb27     
  AZURE_TENANT_ID: 024633c0-99cb-4f14-9a2f-55de40951d4d

      
jobs:
  build-push-deploy:
    runs-on: ubuntu-latest

    permissions:
      id-token: write   # Required for OIDC login
      contents: read

    steps:
    # 1️⃣ Checkout code
    - name: Checkout code
      uses: actions/checkout@v4

    # 2️⃣ Login to Azure using OIDC (secure, no client secret)
    - name: Log in to Azure
      uses: azure/login@v2
      with:
        client-id: $AZURE_CLIENT_ID
        tenant-id: $AZURE_TENANT_ID
        subscription-id: $AZURE_SUBSCRIPTION_ID
        auth-type: SERVICE_PRINCIPAL

